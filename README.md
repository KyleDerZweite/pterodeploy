# PteroDeploy üöÄ

**Intelligent Nest & Egg Factory for Pterodactyl Panels - Automated Minecraft Modpack Processing**

PteroDeploy transforms complex modpack analysis into simple, one-click Pterodactyl server deployments. Paste a Modrinth URL, watch intelligent processing happen in real-time, then deploy through your familiar Pterodactyl interface with pre-configured, optimized eggs.

## ‚ú® Core Philosophy

**PteroDeploy** = Smart Configuration Engine  
**Pterodactyl** = Server Management & Control  
**Result** = Seamless modded server deployment experience

```
User Flow: Modrinth URL ‚Üí PteroDeploy Analysis ‚Üí Pterodactyl Egg ‚Üí 1-Click Deploy
```

## üéØ Key Features

- üß† **Intelligent Modpack Analysis**: Automatic Minecraft version, mod loader, and dependency detection
- ü•ö **Dynamic Egg Generation**: Creates optimized Pterodactyl eggs for each modpack
- üèóÔ∏è **Automated Nest Management**: Organizes eggs in "PD-Minecraft-Modded" nest
- ‚ö° **Real-time Processing**: Live progress tracking with WebSocket updates
- üîß **Smart Configuration**: Auto-selects Docker images, memory requirements, and JVM arguments
- üì¶ **Server Pack Optimization**: Pre-processes files, removes client mods, optimizes configs
- üëë **Admin Dashboard**: User management with role-based access control

## üöÄ Quick Start

### Prerequisites
- Node.js 18+
- npm or yarn
- Git

### One-Command Setup
```bash
# Clone and setup everything
git clone <your-repo-url> pterodeploy
cd pterodeploy
./setup.sh
```

### Manual Setup
1. **Copy environment file:**
   ```bash
   cp .env.example .env
   ```

2. **Edit .env with your settings:**
   - Add AI provider API keys (OpenAI, Ollama, etc.)
   - Secrets are auto-generated by setup script

3. **Install dependencies and setup database:**
   ```bash
   npm run install:all
   npm run db:generate
   npm run db:migrate
   ```

### Development

**Start all services:**
```bash
./dev-start.sh
```

**Stop all services:**
```bash
./dev-stop.sh
```

**Individual services:**
```bash
npm run dev:backend   # Backend on :3001
npm run dev:frontend  # Frontend on :5173
```

### Access Points
- **Frontend**: http://localhost:5173
- **Backend API**: http://localhost:3001
- **Admin Dashboard**: http://localhost:5173/admin (first user = admin)

### AI Provider Configuration

PteroDeploy supports multiple AI providers for intelligent modpack analysis:

**Supported Providers:**
- **OpenAI**: GPT-4/3.5 for best analysis quality
- **LiteLLM**: Universal proxy (supports Claude, Gemini, etc.)
- **Ollama**: Local models (privacy-focused)
- **Claude CLI**: Direct Claude integration (Pro subscription)

**Setup via Admin Dashboard:**
1. Register first user (becomes admin automatically)
2. Go to Admin ‚Üí AI Providers tab
3. Add your preferred provider with API credentials
4. Test connection and activate

**Environment Configuration:**
```bash
# Example .env settings
OPENAI_API_KEY=sk-your-key-here
OLLAMA_URL=http://localhost:11434
LITELLM_BASE_URL=http://localhost:4000
```

### Optional Dependencies 
- Redis server (for job processing)
- Pterodactyl panel with API access

### Installation

```bash
# Clone the repository
git clone <repository-url>
cd pterodeploy

# Install all dependencies
npm run install:all

# Set up environment variables
cp backend/.env.example backend/.env
# Edit backend/.env with your Pterodactyl API credentials

# Start Redis (Docker Compose)
docker-compose up -d redis

# Start both services
npm run dev
```

The application will be available at:
- **Frontend**: http://localhost:5173
- **Backend API**: http://localhost:3001

## üéÆ How It Works

### Phase 1: Modpack Processing (PteroDeploy)

1. **Submit URL**: User pastes Modrinth modpack URL (e.g., `https://modrinth.com/modpack/prominence-2-fabric`)
2. **Analysis**: Intelligent processing extracts:
   - Minecraft version (1.20.1)
   - Mod loader (Fabric 0.14.21)
   - Dependencies (124 mods)
   - Resource requirements (6GB RAM recommended)
3. **Egg Generation**: Creates optimized Pterodactyl egg with:
   - Correct Docker image (Java 17 for MC 1.20.1)
   - Startup command with proper JVM args
   - Environment variables (SERVER_MEMORY, MAX_PLAYERS)
   - Install script for server pack download

### Phase 2: Deployment (Pterodactyl)

1. **Navigate to Pterodactyl**: User goes to their panel
2. **Create Server**: Standard Pterodactyl server creation
3. **Select Nest/Egg**: Choose "PD-Minecraft-Modded" ‚Üí "Prominence II Fabric"
4. **Configure**: Adjust memory (pre-filled: 6GB), players (20), server name
5. **Deploy**: Click create ‚Üí Server provisions automatically with all mods ready

## üõ†Ô∏è Admin Configuration

### Pterodactyl Connection Setup

1. **Login as Admin**: First registered user becomes admin automatically
2. **Navigate to Settings**: `/admin/settings` in PteroDeploy
3. **Configure Pterodactyl**:
   - Panel URL: `https://your-pterodactyl-panel.com`
   - API Key: Your application API key
   - Test Connection: Verify credentials

### User Management

Access the admin dashboard at `/admin` to:
- ‚úÖ Approve/reject user registrations
- üëë Promote users to admin
- üìä View processing statistics
- ü•ö Monitor egg generation activity

## üîß Development Commands

```bash
# Development
npm run dev              # Run both services + Redis
npm run dev:backend      # Backend only (port 3001)
npm run dev:frontend     # Frontend only (port 5173)

# Database
npm run db:generate      # Generate Prisma client
npm run db:migrate       # Run migrations
npm run db:studio        # Open database GUI

# Build
npm run build            # Build both services
npm run build:backend    # Backend TypeScript compilation
npm run build:frontend   # Frontend Vite build

# Processing
npm run workers          # Start job processing workers
npm run queue:monitor    # Monitor Redis queues
```

## üèóÔ∏è Technology Stack

**Core Processing**
- **Modrinth API**: Official API for modpack metadata
- **BullMQ + Redis**: Asynchronous job processing
- **Pterodactyl API**: Nest/egg creation and management

**Backend**
- Node.js + TypeScript + Express.js
- SQLite + Prisma ORM
- Socket.IO for real-time updates
- JWT authentication with bcrypt

**Frontend**  
- React 18 + TypeScript + Vite
- Tailwind CSS + shadcn/ui components
- Zustand for state management
- React Router v6 with protected routes

## üìÅ Project Structure

```
pterodeploy/
‚îú‚îÄ‚îÄ backend/                 # Express.js API server
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/         # API endpoints (auth, admin, processing)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ workers/        # BullMQ job processors
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/       # Modrinth client, Pterodactyl client
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/          # Egg generation, file processing
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware/     # Authentication middleware
‚îÇ   ‚îú‚îÄ‚îÄ prisma/             # Database schema and migrations
‚îÇ   ‚îî‚îÄ‚îÄ admin-cli.js        # Emergency admin CLI tool
‚îú‚îÄ‚îÄ frontend/               # React application
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/     # UI components (processing, admin)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/          # Main pages and admin dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/       # React contexts (auth, socket)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stores/         # Zustand stores
‚îú‚îÄ‚îÄ docs/                   # Project documentation
‚îÇ   ‚îî‚îÄ‚îÄ ROADMAP_PLAN.md     # Complete development roadmap
‚îî‚îÄ‚îÄ docker-compose.yml      # Redis and supporting services
```

## üéØ Supported Modpack Sources

### Currently Supported
- ‚úÖ **Modrinth URLs**: `https://modrinth.com/modpack/[project-name]`
- ‚úÖ **Direct ZIP Files**: Modrinth-format modpack exports

### Planned Support (Roadmap)
- üîÑ **CurseForge**: CF modpack manifest parsing
- üîÑ **ATLauncher**: ATL pack format support  
- üîÑ **Technic**: Technic launcher packs
- üîÑ **Custom Formats**: Generic ZIP with manifest detection

## üîí Security Features

- **Encrypted API Storage**: Pterodactyl API keys encrypted at rest (AES-256-GCM)
- **Role-based Access**: Admin vs User permissions
- **Secure File Processing**: ZIP bomb protection, path traversal prevention
- **Rate Limiting**: API request throttling
- **Input Validation**: URL and file format validation

## üìä Processing Pipeline

### Modpack Analysis Worker
```
Input: Modrinth URL
‚îú‚îÄ‚îÄ Extract project ID
‚îú‚îÄ‚îÄ Fetch metadata via Modrinth API
‚îú‚îÄ‚îÄ Resolve dependencies (124 mods)
‚îú‚îÄ‚îÄ Determine requirements (MC 1.20.1, Fabric, Java 17)
‚îî‚îÄ‚îÄ Generate configuration data
```

### Egg Generation Worker  
```
Input: Configuration data
‚îú‚îÄ‚îÄ Select Docker image (ghcr.io/pterodactyl/yolks:java_17)
‚îú‚îÄ‚îÄ Generate startup command with JVM args
‚îú‚îÄ‚îÄ Create environment variables (SERVER_MEMORY=6)
‚îú‚îÄ‚îÄ Build install script for server pack download
‚îî‚îÄ‚îÄ Deploy to Pterodactyl nest
```

## üö® Emergency Admin Access

If you're locked out, use the CLI tool:

```bash
cd backend

# Create emergency admin
node admin-cli.js create-admin emergency secretpassword

# List all users
node admin-cli.js list-users

# Approve pending user
node admin-cli.js approve username

# Show all commands
node admin-cli.js --help
```

## üìà Success Metrics

- **Processing Success Rate**: >98% successful modpack analysis
- **Egg Generation Time**: <2 minutes for standard modpacks
- **Deployment Success**: >95% successful Pterodactyl deployments
- **User Experience**: 1-click deployment from familiar Pterodactyl interface

## üó∫Ô∏è Roadmap

**Phase 1 (Current)**: Modrinth + Fabric/Forge support with basic egg generation  
**Phase 2**: Multi-platform support (CurseForge, ATLauncher) with advanced optimization  
**Phase 3**: Multi-game support (Rust, GMod, ARK) with enterprise features  
**Phase 4**: Community marketplace with template sharing

See [ROADMAP_PLAN.md](docs/ROADMAP_PLAN.md) for complete development plan.

## ü§ù Contributing

1. Review the roadmap in `docs/ROADMAP_PLAN.md`
2. Check technical documentation in `CLAUDE.md`
3. Follow existing TypeScript patterns and security practices
4. Test with real Modrinth modpacks and Pterodactyl integration

## üìö Documentation

- **[Development Roadmap](docs/ROADMAP_PLAN.md)**: Complete implementation plan
- **[Technical Guide](CLAUDE.md)**: Detailed system architecture
- **[API Documentation](docs/API.md)**: RESTful endpoints reference

---

**Transform modpack complexity into Pterodactyl simplicity** - PteroDeploy handles the analysis, Pterodactyl handles the deployment.